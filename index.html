<!DOCTYPE html>
<html>
<head>
    <title>Mars Crypto Conflict</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="telegram-web-app-theme-color" content="#8B4513">
    <style>
        /* ... (–≤–µ—Å—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π CSS –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ... */
        
        /* –î–û–ë–ê–í–õ–Ø–ï–ú –ö–ù–û–ü–ö–£ –°–¢–†–û–ò–¢–ï–õ–¨–°–¢–í–ê */
        .build-btn {
            background: linear-gradient(135deg, #2E8B57, #3CB371);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 15px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
            margin-left: 10px;
        }
        
        .build-btn:hover {
            background: linear-gradient(135deg, #3CB371, #66CDAA);
            transform: scale(1.05);
        }
        
        /* –ú–ï–ù–Æ –°–¢–†–û–ò–¢–ï–õ–¨–°–¢–í–ê */
        .build-menu {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #8B4513;
            border-radius: 15px;
            padding: 20px;
            width: 320px;
            max-width: 90vw;
            max-height: 80vh;
            z-index: 2000;
            display: none;
            flex-direction: column;
            gap: 15px;
            box-shadow: 0 0 30px rgba(139, 69, 19, 0.5);
            overflow-y: auto;
        }
        
        .build-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 10px;
            border-bottom: 1px solid #8B4513;
        }
        
        .build-menu-title {
            font-size: 18px;
            font-weight: bold;
            color: gold;
        }
        
        .build-menu-close {
            background: none;
            border: none;
            color: #FF5555;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .build-menu-close:hover {
            background: rgba(255,85,85,0.2);
        }
        
        .build-options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
            margin: 10px 0;
        }
        
        .build-option {
            background: rgba(139, 69, 19, 0.2);
            border: 1px solid #D2691E;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            text-align: center;
        }
        
        .build-option:hover {
            background: rgba(139, 69, 19, 0.4);
            transform: translateY(-3px);
        }
        
        .build-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .build-option.disabled:hover {
            background: rgba(139, 69, 19, 0.2);
            transform: none;
        }
        
        .build-option-icon {
            font-size: 30px;
            margin-bottom: 5px;
        }
        
        .build-option-name {
            font-size: 14px;
            font-weight: bold;
            color: white;
        }
        
        .build-option-desc {
            font-size: 11px;
            color: #ccc;
            line-height: 1.3;
        }
        
        .build-option-cost {
            font-size: 12px;
            color: gold;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .build-option-free {
            color: #00FF00;
            animation: pulse-green 1s infinite;
        }
        
        .build-hint {
            font-size: 12px;
            color: #888;
            text-align: center;
            margin-top: 10px;
            line-height: 1.4;
        }
        
        /* –≠–§–§–ï–ö–¢ –î–õ–Ø –¢–ê–ü–ê –ù–ê –ö–ê–†–¢–£ */
        .tap-indicator {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0, 200, 255, 0.6) 0%, rgba(0, 200, 255, 0) 70%);
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 500;
            animation: tap-pulse 0.5s ease-out;
        }
        
        /* –ê–ù–ò–ú–ê–¶–ò–ò */
        @keyframes tap-pulse {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(2);
                opacity: 0;
            }
        }
        
        @keyframes pulse-green {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }
    </style>
</head>
<body>
    <!-- –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ -->
    <div id="top-panel">
        <div class="stats-row">
            <div class="stat-item">
                <span>üí∞</span>
                <span class="stat-value" id="balance">0.00</span>
                <span>MNRT</span>
            </div>
            <div class="stat-item">
                <span>üè†</span>
                <span class="stat-value" id="storage">0/100</span>
                <span>MNRT</span>
            </div>
            <div class="stat-item">
                <span>‚ö°</span>
                <span class="stat-value" id="energy">0/0</span>
            </div>
            <div class="stat-item">
                <span>üèóÔ∏è</span>
                <span class="stat-value" id="building-count">0</span>
            </div>
            <!-- –°–ß–ï–¢–ß–ò–ö –î–û–ë–´–ß–ò -->
            <div class="mining-counter" id="mining-counter">
                <span>‚õèÔ∏è</span>
                <span>–î–æ–±—ã—á–∞:</span>
                <span class="mining-counter-value" id="mining-rate">0.000/—Å–µ–∫</span>
            </div>
        </div>
        
        <div style="display: flex; gap: 10px;">
            <!-- –ö–ù–û–ü–ö–ê –°–¢–†–û–ò–¢–ï–õ–¨–°–¢–í–ê -->
            <button class="build-btn" onclick="showBuildMenu()">
                <span>üèóÔ∏è</span>
                <span>–°—Ç—Ä–æ–∏—Ç—å</span>
            </button>
            
            <button class="collect-btn" onclick="collectFromBase()" id="collect-btn" disabled>
                <span>üí∞</span>
                <span>–°–æ–±—Ä–∞—Ç—å –Ω–∞ –±–∞–ª–∞–Ω—Å</span>
            </button>
        </div>
    </div>
    
    <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† -->
    <div id="game-container">
        <!-- –û–°–ù–û–í–ù–û–ô –≠–ö–†–ê–ù - –ú–ê–†–° -->
        <div id="mars-surface"></div>
        
        <!-- ... (–æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ... -->
    </div>
    
    <!-- ... (–Ω–∏–∂–Ω–µ–µ –º–µ–Ω—é –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ... -->
    
    <!-- –ú–ï–ù–Æ –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ó–î–ê–ù–ò–ï–ú -->
    <div id="building-context-menu" class="building-context-menu">
        <!-- ... (—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –º–µ–Ω—é –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ... -->
    </div>
    
    <!-- –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï –£–î–ê–õ–ï–ù–ò–Ø -->
    <div id="delete-confirm" class="delete-confirm">
        <!-- ... (—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ... -->
    </div>
    
    <!-- –ú–ï–ù–Æ –°–¢–†–û–ò–¢–ï–õ–¨–°–¢–í–ê -->
    <div id="build-menu" class="build-menu">
        <div class="build-menu-header">
            <div class="build-menu-title">üèóÔ∏è –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ</div>
            <button class="build-menu-close" onclick="closeBuildMenu()">‚úï</button>
        </div>
        
        <div class="build-hint">
            –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∑–¥–∞–Ω–∏—è –¥–ª—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞. –ü–µ—Ä–≤–∞—è –ø–æ—Å—Ç—Ä–æ–π–∫–∞ –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ - –ë–ï–°–ü–õ–ê–¢–ù–û!
        </div>
        
        <div class="build-options-grid" id="build-options-container">
            <!-- –ó–î–ê–ù–ò–Ø –ë–£–î–£–¢ –î–û–ë–ê–í–õ–ï–ù–´ –ß–ï–†–ï–ó JavaScript -->
        </div>
        
        <div class="build-hint">
            –ü–æ–¥—Å–∫–∞–∑–∫–∞: –î–ª—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É. –î–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é - –¥–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ –∑–¥–∞–Ω–∏–µ.
        </div>
    </div>
    
    <!-- –°–û–û–ë–©–ï–ù–ò–Ø -->
    <div id="message"></div>

    <!-- TELEGRAM WEB APP SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <script>
        // ============================
        // –î–û–ë–ê–í–õ–Ø–ï–ú –ù–û–í–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
        // ============================
        let tapTimer = null;
        let isLongTap = false;
        let lastTapX = 0;
        let lastTapY = 0;
        
        // ============================
        // –û–ë–ù–û–í–õ–Ø–ï–ú showTab –î–õ–Ø –°–ö–†–´–¢–ò–Ø –ú–ï–ù–Æ –°–¢–†–û–ò–¢–ï–õ–¨–°–¢–í–ê
        // ============================
        function showTab(tabName) {
            // ... (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è) ...
            
            // –°–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ –≤–∫–ª–∞–¥–æ–∫
            if (tabName !== 'mars') {
                closeBuildMenu();
            }
        }
        
        // ============================
        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ú–ï–ù–Æ –°–¢–†–û–ò–¢–ï–õ–¨–°–¢–í–ê
        // ============================
        function showBuildMenu() {
            const menu = document.getElementById('build-menu');
            menu.style.display = 'flex';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–¥–∞–Ω–∏–π
            updateBuildOptions();
        }
        
        function closeBuildMenu() {
            const menu = document.getElementById('build-menu');
            menu.style.display = 'none';
        }
        
        function updateBuildOptions() {
            const container = document.getElementById('build-options-container');
            container.innerHTML = '';
            
            const buildingTypes = [
                { type: 'base', name: '–ë–∞–∑–∞', desc: '–•—Ä–∞–Ω–∏—Ç –¥–æ–±—ã—Ç—ã–µ —Ä–µ—Å—É—Ä—Å—ã. –ù—É–∂–Ω–∞ –¥–ª—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –¥—Ä—É–≥–∏—Ö –∑–¥–∞–Ω–∏–π.', icon: 'üè†', required: '–ù–µ—Ç –±–∞–∑—ã' },
                { type: 'mining', name: '–ë—É—Ä–æ–≤–∞—è', desc: '–î–æ–±—ã–≤–∞–µ—Ç MNRT. –¢—Ä–µ–±—É–µ—Ç —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—é.', icon: '‚õèÔ∏è', required: '–ù—É–∂–Ω–∞ –±–∞–∑–∞' },
                { type: 'power', name: '–≠–ª–µ–∫—Ç—Ä–æ—Å—Ç–∞–Ω—Ü–∏—è', desc: '–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—é –¥–ª—è –±—É—Ä–æ–≤—ã—Ö.', icon: '‚ö°', required: '–ù—É–∂–Ω–∞ –±–∞–∑–∞' }
            ];
            
            buildingTypes.forEach(building => {
                const isFirstFree = CONFIG.FREE_BUILDINGS[building.type] && !gameState.freeBuildingsUsed[building.type];
                const cost = isFirstFree ? 0 : CONFIG.BUILDING_COSTS[building.type];
                
                let isAvailable = true;
                let requirement = '';
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
                if (building.type === 'base' && gameState.hasBase) {
                    isAvailable = false;
                    requirement = '–£–∂–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞';
                } else if ((building.type === 'mining' || building.type === 'power') && !gameState.hasBase) {
                    isAvailable = false;
                    requirement = building.required;
                }
                
                const option = document.createElement('div');
                option.className = `build-option ${!isAvailable ? 'disabled' : ''}`;
                option.onclick = () => {
                    if (!isAvailable) {
                        showMessage(`‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ: ${requirement}`, 'error');
                        return;
                    }
                    startBuilding(building.type);
                    closeBuildMenu();
                };
                
                option.innerHTML = `
                    <div class="build-option-icon">${building.icon}</div>
                    <div class="build-option-name">${building.name}</div>
                    <div class="build-option-desc">${building.desc}</div>
                    <div class="build-option-cost ${isFirstFree ? 'build-option-free' : ''}">
                        ${isFirstFree ? '–ë–ï–°–ü–õ–ê–¢–ù–û!' : `–¶–µ–Ω–∞: ${cost} MNRT`}
                    </div>
                    ${!isAvailable ? `<div style="font-size: 10px; color: #FF5555; margin-top: 5px;">${requirement}</div>` : ''}
                `;
                
                container.appendChild(option);
            });
        }
        
        // ============================
        // –û–ë–†–ê–ë–û–¢–ö–ê –î–û–õ–ì–û–ì–û –ù–ê–ñ–ê–¢–ò–Ø
        // ============================
        function handleSurfaceTouchStart(e) {
            const surface = document.getElementById('mars-surface');
            const rect = surface.getBoundingClientRect();
            
            lastTapX = e.clientX || e.touches[0].clientX;
            lastTapY = e.clientY || e.touches[0].clientY;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø–æ–ø–∞–ª–∏ –ª–∏ –≤ –∑–¥–∞–Ω–∏–µ
            const buildingElements = document.querySelectorAll('.building');
            let clickedOnBuilding = false;
            
            buildingElements.forEach(building => {
                const buildingRect = building.getBoundingClientRect();
                if (
                    lastTapX >= buildingRect.left && 
                    lastTapX <= buildingRect.right &&
                    lastTapY >= buildingRect.top && 
                    lastTapY <= buildingRect.bottom
                ) {
                    clickedOnBuilding = true;
                }
            });
            
            // –ï—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –Ω–∞ –ø—É—Å—Ç–æ–µ –º–µ—Å—Ç–æ - –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è –¥–æ–ª–≥–æ–≥–æ –Ω–∞–∂–∞—Ç–∏—è
            if (!clickedOnBuilding) {
                isLongTap = false;
                tapTimer = setTimeout(() => {
                    isLongTap = true;
                    showBuildMenuAtPosition(lastTapX, lastTapY);
                }, 800); // 800ms –¥–ª—è –¥–æ–ª–≥–æ–≥–æ –Ω–∞–∂–∞—Ç–∏—è
            }
        }
        
        function handleSurfaceTouchEnd(e) {
            clearTimeout(tapTimer);
            
            // –ï—Å–ª–∏ –±—ã–ª–æ –¥–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ - –æ—Ç–º–µ–Ω—è–µ–º –æ–±—ã—á–Ω—ã–π –∫–ª–∏–∫
            if (isLongTap) {
                e.preventDefault();
                e.stopPropagation();
            }
        }
        
        function showBuildMenuAtPosition(x, y) {
            const menu = document.getElementById('build-menu');
            
            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –º–µ–Ω—é —Ä—è–¥–æ–º —Å –º–µ—Å—Ç–æ–º –Ω–∞–∂–∞—Ç–∏—è
            const menuWidth = 320;
            const menuHeight = 400;
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            
            let finalX = x;
            let finalY = y;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã —ç–∫—Ä–∞–Ω–∞
            if (finalX + menuWidth > screenWidth - 20) {
                finalX = screenWidth - menuWidth - 20;
            }
            
            if (finalY + menuHeight > screenHeight - 80) {
                finalY = screenHeight - menuHeight - 80;
            }
            
            if (finalX < 20) finalX = 20;
            if (finalY < 80) finalY = 80;
            
            menu.style.position = 'fixed';
            menu.style.left = finalX + 'px';
            menu.style.top = finalY + 'px';
            menu.style.transform = 'none';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–ø—Ü–∏–∏ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞
            updateBuildOptions();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é
            menu.style.display = 'flex';
            
            // –°–æ–∑–¥–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç —Ç–∞–ø–∞
            createTapIndicator(x, y);
        }
        
        function createTapIndicator(x, y) {
            const surface = document.getElementById('mars-surface');
            const indicator = document.createElement('div');
            indicator.className = 'tap-indicator';
            indicator.style.left = x + 'px';
            indicator.style.top = y + 'px';
            
            document.body.appendChild(indicator);
            
            setTimeout(() => {
                indicator.remove();
            }, 500);
        }
        
        // ============================
        // –û–ë–ù–û–í–õ–Ø–ï–ú startBuilding –î–õ–Ø –ü–û–ö–ê–ó–ê –ü–û–î–°–ö–ê–ó–ö–ò
        // ============================
        function startBuilding(type) {
            const isFirstBuildingFree = CONFIG.FREE_BUILDINGS[type] && !gameState.freeBuildingsUsed[type];
            const cost = isFirstBuildingFree ? 0 : CONFIG.BUILDING_COSTS[type];
            
            if (!isFirstBuildingFree && gameState.gameBalance < cost) {
                showMessage(`‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ MNRT! –ù—É–∂–Ω–æ: ${cost}`, 'error');
                return;
            }
            
            if ((type === 'mining' || type === 'power') && !gameState.hasBase) {
                showMessage('‚ùå –°–Ω–∞—á–∞–ª–∞ –ø–æ—Å—Ç—Ä–æ–π—Ç–µ –±–∞–∑—É!', 'error');
                return;
            }
            
            if (type === 'base' && gameState.hasBase) {
                showMessage('‚ùå –£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –±–∞–∑–∞!', 'error');
                return;
            }
            
            gameState.placingBuilding = type;
            
            // –°–æ–∑–¥–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç —Ç–∞–ø–∞ –≤ —Ü–µ–Ω—Ç—Ä–µ —ç–∫—Ä–∞–Ω–∞
            const surface = document.getElementById('mars-surface');
            const rect = surface.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            createTapIndicator(centerX, centerY);
            
            const message = isFirstBuildingFree ? 
                `üèóÔ∏è –í—ã–±—Ä–∞–Ω–∞ ${getBuildingName(type)}. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è (–ë–ï–°–ü–õ–ê–¢–ù–û!)` : 
                `üèóÔ∏è –í—ã–±—Ä–∞–Ω–∞ ${getBuildingName(type)}. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è (${cost} MNRT)`;
            
            showMessage(message, 'success');
            
            // –ï—Å–ª–∏ –º—ã –≤ —Ä–µ–∂–∏–º–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è, –≤—ã–∫–ª—é—á–∞–µ–º –µ–≥–æ
            if (movingBuildingId !== null) {
                exitMoveMode();
            }
        }
        
        // ============================
        // –î–û–ë–ê–í–õ–Ø–ï–ú –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô
        // ============================
        function initEventListeners() {
            const surface = document.getElementById('mars-surface');
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º—ã—à–∏
            surface.addEventListener('mousedown', handleSurfaceTouchStart);
            surface.addEventListener('mouseup', handleSurfaceTouchEnd);
            surface.addEventListener('mouseleave', () => clearTimeout(tapTimer));
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ç–∞—á-—É—Å—Ç—Ä–æ–π—Å—Ç–≤
            surface.addEventListener('touchstart', handleSurfaceTouchStart);
            surface.addEventListener('touchend', handleSurfaceTouchEnd);
            surface.addEventListener('touchcancel', () => clearTimeout(tapTimer));
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
            document.addEventListener('click', function(e) {
                const buildMenu = document.getElementById('build-menu');
                const buildBtn = document.querySelector('.build-btn');
                
                if (buildMenu.style.display === 'flex' && 
                    !buildMenu.contains(e.target) && 
                    !buildBtn.contains(e.target)) {
                    closeBuildMenu();
                }
            });
        }
        
        // ============================
        // –û–ë–ù–û–í–õ–Ø–ï–ú initGame
        // ============================
        function initGame() {
            // –°–æ–∑–¥–∞–µ–º –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å –ú–∞—Ä—Å–∞
            generateMarsSurface();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            initEventListeners();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateUI();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            gameState.lastUpdate = Date.now();
            gameState.gameStartTime = Date.now();
            setInterval(updateMining, 1000);
            
            // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            setTimeout(() => {
                showMessage('üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Mars Crypto Conflict! –ü–µ—Ä–≤–∞—è –ø–æ—Å—Ç—Ä–æ–π–∫–∞ –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –∑–¥–∞–Ω–∏–π - –ë–ï–°–ü–õ–ê–¢–ù–û!', 'success');
            }, 1000);
        }
        
        // ... (–æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
    </script>
</body>
</html>
